<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Ruiby by glurp</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Ruiby</h1>
          <h2>DSL for make a simple ruby GUI application</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/glurp/dsl-gtk/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/glurp/dsl-gtk/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/glurp/dsl-gtk" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="resources" class="anchor" href="#resources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Resources</h1>

<p>Code: <a href="http://github.com/glurp/Ruiby">http://github.com/glurp/Ruiby</a></p>

<p>Doc: <a href="https://rawgithub.com/glurp/Ruiby/master/doc.html">Reference+Exemples.</a>   </p>

<p>Gem : <a href="https://rubygems.org/gems/Ruiby">https://rubygems.org/gems/Ruiby</a></p>

<h1>
<a id="status" class="anchor" href="#status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Status</h1>

<p>NEW : 1.32.5  !!   05-12-2015</p>

<p>WARNING !!!! current ruby-gtk3 version 2.2.4 is buggy on Windows ruby/32, bt ok wirh Ruby/x64 !!! </p>

<p>TODO  :</p>

<ul>
<li>[x] make a demo of a gadget: REST/gui canvas/dialog/config</li>
<li>[x] grid : get selection double-click, debug...</li>
<li>[x] waiting gtk3 &gt; 2.2.4</li>
<li>[ ] Gadget api: atuel gadget are cairo drawing =&gt; to be encapsuled</li>
<li>[ ] editor / executor  : console/canvas/widget+help</li>
<li>[ ] refactor samples demos with last improve: dynvar/autoslot...</li>
<li>[ ] resolve 100% gtk3 deprecated warning</li>
<li>[ ] corrections in ruiby_require(?)</li>
<li>[ ] complete treeview and tree_grid,</li>
<li>[ ] complete rspec =&gt; 99% coverage ?</li>
</ul>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>1) system</p>

<p>Install Ruby 2.x</p>

<p>2) install Ruiby
(Ruiby install ruby-gtk3 which install gtk3 libs)</p>

<pre><code>&gt; gem install Ruiby

&gt; ruiby_demo             # check good installation with gtk3 (default)
&gt; ruiby_sketchi          # write and test ruiby code
</code></pre>

<p>3) if you need video/gstreamer, install gst/clutter :</p>

<pre><code>  &gt; gem install gstreamer 
  &gt; gem install clutter-gtk
  &gt; gem install clutter-gstreamer
</code></pre>

<p>Here a working gem config on windows (15-September-2014, ruby 2.0.0p0) :</p>

<pre><code> pkg-config  1.1.4
       cairo 1.12.8
      glib2  2.2.0
 gobject-introspection  2.2.0
       gio2  2.2.0
        atk  2.2.0
      pango  2.2.0
 gdk_pixbuf2  2.2.0
       gdk3  2.2.0
       gtk3  2.2.0
  gstreamer  2.2.0
 cairo-gobject  2.2.0
    clutter  2.2.0
clutter-gtk  2.2.0
 clutter-gstreamer  2.2.0
</code></pre>

<h1>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h1>

<p>DSL is usable via inherit, include, Ruiby.app bloc, or one-liner command.</p>

<p>By inherit:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">Application<span class="pl-e"> &lt; Ruiby_gtk</span></span>
    <span class="pl-k">def</span> <span class="pl-en">initialize</span>(<span class="pl-smi">t</span>,<span class="pl-smi">w</span>,<span class="pl-smi">h</span>)
        <span class="pl-k">super</span>(t,w,h)
    <span class="pl-k">end</span> 
    <span class="pl-k">def</span> <span class="pl-en">component</span>()
      stack <span class="pl-k">do</span>
        ...
      <span class="pl-k">end</span>
    <span class="pl-k">end</span>
    .....your code....
<span class="pl-k">end</span>
<span class="pl-c1">Ruiby</span>.start { <span class="pl-c1">Win</span>.<span class="pl-k">new</span>(<span class="pl-s"><span class="pl-pds">"</span>application title<span class="pl-pds">"</span></span>,<span class="pl-c1">350</span>,<span class="pl-c1">10</span>) }
</pre></div>

<p>By include, calling ruiby_component() :</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">Win<span class="pl-e"> &lt; Gtk::Window</span></span>
    <span class="pl-k">include</span> <span class="pl-c1">Ruiby</span>
    <span class="pl-k">def</span> <span class="pl-en">initialize</span>(<span class="pl-smi">t</span>,<span class="pl-smi">w</span>,<span class="pl-smi">h</span>)
        <span class="pl-k">super</span>()
        add(<span class="pl-smi">@vb</span><span class="pl-k">=</span><span class="pl-c1">VBox</span>.<span class="pl-k">new</span>(<span class="pl-c1">false</span>, <span class="pl-c1">2</span>)) 
        ....
    <span class="pl-k">end</span> 
    <span class="pl-k">def</span> <span class="pl-en">add_a_ruiby_button</span>() 
        ruiby_component <span class="pl-k">do</span>
            append_to(<span class="pl-smi">@vb</span>) <span class="pl-k">do </span>
                button(<span class="pl-s"><span class="pl-pds">"</span>Hello Word <span class="pl-pse">#{</span><span class="pl-s1"><span class="pl-smi">@vb</span>.children.size</span><span class="pl-pse"><span class="pl-s1">}</span></span><span class="pl-pds">"</span></span>) {
                    add_a_ruiby_button() 
                }
            <span class="pl-k">end</span>
        <span class="pl-k">end</span>
    <span class="pl-k">end</span>
<span class="pl-k">end</span>
<span class="pl-c1">Ruiby</span>.start { <span class="pl-c1">Win</span>.<span class="pl-k">new</span>(<span class="pl-s"><span class="pl-pds">"</span>application title<span class="pl-pds">"</span></span>,<span class="pl-c1">350</span>,<span class="pl-c1">10</span>) }</pre></div>

<p>Autonomous DSL, for  little application :</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">require</span>  <span class="pl-s"><span class="pl-pds">'</span>Ruiby<span class="pl-pds">'</span></span>
<span class="pl-c1">Ruiby</span>.app <span class="pl-k">do</span>
    stack <span class="pl-k">do</span>
        . . . 
    <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<p>And, for very little application ('~' are replaced by guillemet):</p>

<div class="highlight highlight-ruby"><pre>
<span class="pl-k">&gt;</span> ruiby   button(<span class="pl-k">~</span><span class="pl-c1">Continue</span> <span class="pl-k">?</span> <span class="pl-k">~</span>) <span class="pl-s"><span class="pl-pds">"</span>{  exit!(0) }<span class="pl-pds">"</span></span>
<span class="pl-k">&gt;</span> ruiby   fields([<span class="pl-s"><span class="pl-pds">%w{</span>a b<span class="pl-pds">}</span></span>,<span class="pl-s"><span class="pl-pds">%w{</span>b c<span class="pl-pds">}</span></span>,<span class="pl-s"><span class="pl-pds">%w{</span>c d<span class="pl-pds">}</span></span>]) { <span class="pl-s"><span class="pl-pds">"</span>|a,b,c|<span class="pl-pds">"</span></span> p [a,b,c] <span class="pl-k">if</span> a; exit!(a <span class="pl-c1">?0</span>:<span class="pl-c1">1</span>) }
<span class="pl-k">&gt;</span> ruiby <span class="pl-k">-</span>width <span class="pl-c1">100</span>  <span class="pl-k">-</span>height <span class="pl-c1">300</span> <span class="pl-k">-</span>title <span class="pl-s"><span class="pl-pds">"</span>Please, select a file<span class="pl-pds">"</span></span> \
             l<span class="pl-k">=</span>list(<span class="pl-k">~</span><span class="pl-c1">Files</span> <span class="pl-c1">:~</span>);l.set_data <span class="pl-c1">Dir</span>.glob(<span class="pl-k">~</span><span class="pl-k">*</span><span class="pl-k">~</span>) ;  \
             buttoni(<span class="pl-k">~</span><span class="pl-c1">Selected</span><span class="pl-k">~</span>) { puts l.selection ; exit!(<span class="pl-c1">0</span>) } ;\
             buttoni(<span class="pl-k">~</span><span class="pl-c1">Annul</span><span class="pl-k">~</span>) { exit!(<span class="pl-c1">1</span>) }
</pre></div>

<h1>
<a id="require" class="anchor" href="#require" aria-hidden="true"><span class="octicon octicon-link"></span></a>Require</h1>

<p>Simple usage with gtk3 :</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">require</span> <span class="pl-s"><span class="pl-pds">'</span>Ruiby<span class="pl-pds">'</span></span></pre></div>

<p>Usage with Event Machine: preload event-machine before Ruiby :</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">require</span> <span class="pl-s"><span class="pl-pds">'</span>em-proxy<span class="pl-pds">'</span></span>
<span class="pl-k">require</span> <span class="pl-s"><span class="pl-pds">'</span>Ruiby<span class="pl-pds">'</span></span></pre></div>

<p>Warning : EM.run is done when starting mainloop, after creation of window(s).
So, if you need initialization of event-machine callback, do it in component(), in a after(0):</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c1">Ruiby</span>.app <span class="pl-k">do</span>
  ....
  after(<span class="pl-c1">0</span>) { <span class="pl-c1">EventMachine</span>::start_server().. { ... } }
<span class="pl-k">end</span></pre></div>

<p>See samples/spygui.rb, for exemple of gui with EM.</p>

<h1>
<a id="threading" class="anchor" href="#threading" aria-hidden="true"><span class="octicon octicon-link"></span></a>Threading</h1>

<p>Ruiby does not have confidence in gtk multi threading, so all Ruiby commands must be done in
main thread context. A Ruiby delegate is provided in Kernel module for support multi-threading</p>

<p>A Queue is polled by main-window thread :</p>

<ul>
<li>main window poll Queue , messagers are proc to be instance_eval() in the main window context</li>
<li>everywere, a thread can invoke <code>invoke_gui {ruiby code}</code>. this send to the main queue the proc,
which will be evaluated asynchroniously </li>
</ul>

<p>instance_eval is avoided in ruiby. He is used only for thread invoker : gui_invoke().</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">require_relative</span> <span class="pl-s"><span class="pl-pds">'</span>../lib/Ruiby<span class="pl-pds">'</span></span>
<span class="pl-k">class</span> <span class="pl-en">App<span class="pl-e"> &lt; Ruiby_gtk</span></span>
    <span class="pl-k">def</span> <span class="pl-en">initialize</span>
        <span class="pl-k">super</span>(<span class="pl-s"><span class="pl-pds">"</span>Testing Ruiby for Threading<span class="pl-pds">"</span></span>,<span class="pl-c1">150</span>,<span class="pl-c1">0</span>)
        threader(<span class="pl-c1">10</span>)
        <span class="pl-c1">Thread</span>.<span class="pl-k">new</span> { <span class="pl-c1">A</span>.<span class="pl-k">new</span>.run }
    <span class="pl-k">end</span>
    <span class="pl-k">def</span> <span class="pl-en">component</span>()        
      stack <span class="pl-k">do</span>
        sloti(label(<span class="pl-s"><span class="pl-pds">"</span>Hello, this is Thread test !<span class="pl-pds">"</span></span>))
        stack { <span class="pl-smi">@lab</span><span class="pl-k">=</span>stacki { } }
      <span class="pl-k">end</span>
    <span class="pl-k">end</span> <span class="pl-c"># endcomponent</span>

<span class="pl-k">end</span>
<span class="pl-k">class</span> <span class="pl-en">A</span>
    <span class="pl-k">def</span> <span class="pl-en">run</span>
        <span class="pl-k">loop</span> <span class="pl-k">do</span>
            sleep(<span class="pl-c1">1</span>) <span class="pl-c"># thread...</span>
            there<span class="pl-k">=</span><span class="pl-v">self</span> 
            gui_invoke { append_to(<span class="pl-smi">@lab</span>) { sloti( 
                    label( there.aaa )  <span class="pl-c"># ! instance_eval on main window</span>
            )  } }
        <span class="pl-k">end</span>
    <span class="pl-k">end</span> 
    <span class="pl-k">def</span> <span class="pl-en">aaa</span>() <span class="pl-c1">Time</span>.now.to_s  <span class="pl-k">end</span>
<span class="pl-k">end</span>

<span class="pl-c1">Ruiby</span>.start { <span class="pl-c1">App</span>.<span class="pl-k">new</span> }
</pre></div>

<h1>
<a id="observed-objectvariable" class="anchor" href="#observed-objectvariable" aria-hidden="true"><span class="octicon octicon-link"></span></a>Observed Object/Variable</h1>

<h2>
<a id="dynamic-variable" class="anchor" href="#dynamic-variable" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dynamic variable</h2>

<p>Often, a widget (an entry, a label, a slider...) show the value of a ruby variable.
each time a code mofify this variable, it must modify the widget, and vice-versa...
This is very tyring :)</p>

<p>With data binding, this notifications are done by the framework</p>

<p>So <code>DynVar</code> can be  used for representing a value variable which is dynamics, ie. 
which must notify widgets which show the variable state.</p>

<p>So we can do :</p>

<div class="highlight highlight-ruby"><pre>  foo<span class="pl-k">=</span><span class="pl-c1">DynVar</span>.<span class="pl-k">new</span>(<span class="pl-c1">0</span>)
  entry(foo)
  islider(foo)
  ....
  foo.value<span class="pl-k">=</span><span class="pl-c1">43</span>  
  ....</pre></div>

<p>That works ! the entry and the slider will be updated.</p>

<p>A move on slider will update foo.value and the entry.
Idem for a key in the entry : slider and foo.value will be updated.</p>

<p>if you want to be notified for your own traitment, you can observ a DynVar :</p>

<div class="highlight highlight-ruby"><pre>  foo.observ { |<span class="pl-smi">v</span>| <span class="pl-smi">@socket</span>.puts(v.to_s) <span class="pl-k">rescue</span> <span class="pl-c1">nil</span> }</pre></div>

<p>Here, a modification of foo variable will be send on the network...</p>

<p>Warning !! the block will always be executed in the main thread context (mainloop gtk context).
So DynVar is a ressource internal to Ruiby framework.</p>

<p>Widget which accept DynVar are : entry, ientry, islider, label, check_button, </p>

<p><code>must be extend to button, togglebutton, combo, radio_button ... list, grid,...</code></p>

<h2>
<a id="dynamic-object" class="anchor" href="#dynamic-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dynamic Object</h2>

<p>Often, this kind of Dyn variables are members of a 'record', which should be organised by an
Ruby Object (a Struct...)</p>

<p>So <code>DynObject</code> create a class, which is organised by a hash  :</p>

<ul>
<li>packet of variable name </li>
<li>put initial value for each</li>
<li>each variable will be a DynVar</li>
</ul>

<div class="highlight highlight-ruby"><pre>  <span class="pl-c1">FooClass</span><span class="pl-k">=</span>make_DynClass(<span class="pl-s"><span class="pl-pds">"</span>v1<span class="pl-pds">"</span></span> =&gt; <span class="pl-c1">1</span> , <span class="pl-s"><span class="pl-pds">"</span>v2<span class="pl-pds">"</span></span> =&gt; <span class="pl-c1">2</span>, <span class="pl-s"><span class="pl-pds">"</span>s1<span class="pl-pds">"</span></span> =&gt; <span class="pl-s"><span class="pl-pds">'</span>Hello...<span class="pl-pds">'</span></span>)
  foo<span class="pl-k">=</span><span class="pl-c1">FooClass</span>.<span class="pl-k">new</span>( <span class="pl-s"><span class="pl-pds">"</span>s1<span class="pl-pds">"</span></span> =&gt; <span class="pl-c1">Time</span>.now.to_s ) <span class="pl-c"># default value of s1 variable is replaced </span>
  ...
  label(<span class="pl-s"><span class="pl-pds">"</span> foo: <span class="pl-pds">"</span></span>) ; entry(foo.s1)
  islider(foo.v1)
  islider(foo.v2)
  ....
  button(<span class="pl-s"><span class="pl-pds">"</span>4x33<span class="pl-pds">"</span></span>) { <span class="pl-c1">Thread</span>.<span class="pl-k">new</span> { foo.s1.value<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>s4e33<span class="pl-pds">"</span></span> ; foo.v2.value<span class="pl-k">=</span><span class="pl-c1">33</span> ; foo.v1.value<span class="pl-k">=</span><span class="pl-c1">4</span>} }
  ....</pre></div>

<h2>
<a id="dynamic-stock-object" class="anchor" href="#dynamic-stock-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dynamic Stock Object</h2>

<p>DynObject can be persisted to filesystem : use <code>make_StockDynObject</code>, and
instantiate with an object persistant ID</p>

<div class="highlight highlight-ruby"><pre>  <span class="pl-c1">FooClass</span><span class="pl-k">=</span>make_StockDynClass(<span class="pl-s"><span class="pl-pds">"</span>v1<span class="pl-pds">"</span></span>=&gt; <span class="pl-c1">1</span> , <span class="pl-s"><span class="pl-pds">"</span>v2<span class="pl-pds">"</span></span> =&gt; <span class="pl-c1">2</span>, <span class="pl-s"><span class="pl-pds">"</span>s1<span class="pl-pds">"</span></span> =&gt; <span class="pl-s"><span class="pl-pds">'</span>Hello...<span class="pl-pds">'</span></span>)
  foo1<span class="pl-k">=</span><span class="pl-c1">FooClass</span>.<span class="pl-k">new</span>( <span class="pl-s"><span class="pl-pds">"</span>foo1<span class="pl-pds">"</span></span> , <span class="pl-s"><span class="pl-pds">"</span>s1<span class="pl-pds">"</span></span> =&gt; <span class="pl-c1">Time</span>.now.to_s )
  foo2<span class="pl-k">=</span><span class="pl-c1">FooClass</span>.<span class="pl-k">new</span>( <span class="pl-s"><span class="pl-pds">"</span>foo2<span class="pl-pds">"</span></span> , <span class="pl-s"><span class="pl-pds">"</span>s1<span class="pl-pds">"</span></span> =&gt; (<span class="pl-c1">Time</span>.now<span class="pl-k">+</span><span class="pl-c1">10</span>).to_s )
  ....
  button(<span class="pl-s"><span class="pl-pds">"</span>Exit<span class="pl-pds">"</span></span>) { ruiby_exit} <span class="pl-c"># on exit, foo1 and foo2 will been saved to {tmpdir}/&lt;$0&gt;.storage  </span>
  ....</pre></div>

<p><code>make_StockDynObject</code> do both : Class creation <strong>and</strong> class instanciation.</p>

<div class="highlight highlight-ruby"><pre>  foo<span class="pl-k">=</span>make_StockDynObject(<span class="pl-s"><span class="pl-pds">"</span>v1<span class="pl-pds">"</span></span>=&gt; <span class="pl-c1">1</span> , <span class="pl-s"><span class="pl-pds">"</span>v2<span class="pl-pds">"</span></span> =&gt; <span class="pl-c1">2</span>, <span class="pl-s"><span class="pl-pds">"</span>s1<span class="pl-pds">"</span></span> =&gt; <span class="pl-s"><span class="pl-pds">'</span>Hello...<span class="pl-pds">'</span></span>)
  ....
  button(foo.s1) { foo.s1.value<span class="pl-k">=</span> prompt(<span class="pl-s"><span class="pl-pds">"</span>new S1 value ?<span class="pl-pds">"</span></span>)}
  button(<span class="pl-s"><span class="pl-pds">"</span>Exit<span class="pl-pds">"</span></span>) { ruiby_exit} <span class="pl-c"># on exit, foo1 and foo2 will been saved to {tmpdir}/&lt;$0&gt;.storage  </span>
  ....</pre></div>

<h1>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h1>

<p>LGPL, CC BY-SA</p>

<h1>
<a id="exemples" class="anchor" href="#exemples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exemples</h1>

<p>see samples in "./samples" directory (run all.rb)
cd sampSee at end of Doc reference : <a href="https://rawgithub.com/glurp/Ruiby/master/doc.html#code">Ex.</a> </p>
        </section>

        <footer>
          Ruiby is maintained by <a href="https://github.com/glurp">glurp</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
